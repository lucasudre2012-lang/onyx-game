<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Road Cube</title>
<style>
  :root{--bg:#0f1115;--panel:#171a21;--floor:#252a34;--wall:#3a3f4b;--accent:#6ee7ff;--loot:#d4a94f;--enemy:#ff6b6b;--player:#7CFF88}
  *{box-sizing:border-box}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:#e9eef5;font-family:ui-sans-serif,system-ui,Segoe UI,Roboto,Ubuntu,Arial}
  #wrap{display:flex;flex-direction:column;height:100%}
  header{padding:.5rem 1rem;background:linear-gradient(180deg,#1114,#0000);font-size:.9rem}
  header b{color:var(--accent)}
  #game{flex:1;display:grid;place-items:center;position:relative}
  canvas{display:block;width:100%;height:100%;max-width:1280px;max-height:800px;background:#1a1f27;border:1px solid #ffffff1a;border-radius:12px}
  .hud{position:fixed;left:1rem;bottom:1rem;padding:.5rem .75rem;background:#0008;border:1px solid #fff2;border-radius:10px;font-size:.9rem}
  .scoreTop{position:absolute;top:14px;left:50%;transform:translateX(-50%);background:#000b;padding:0.6rem 1.2rem;border-radius:10px;border:1px solid #fff3;font-size:1.2rem;letter-spacing:.3px;box-shadow:0 6px 18px #0008}
  .menu{position:absolute;inset:0;display:grid;place-items:center;background:linear-gradient(180deg,rgba(0,0,0,.7),rgba(0,0,0,.6));backdrop-filter:blur(2px)}
  .panel{background:#0b0f16;border:1px solid #ffffff22;border-radius:16px;padding:1rem 1.25rem;min-width:340px;box-shadow:0 10px 30px #0008}
  .panel h1{margin:.2rem 0 0.6rem;font-size:1.25rem}
  .row{display:flex;gap:.75rem;align-items:center;justify-content:space-between;margin:.5rem 0}
  .row label{opacity:.9}
  .row input[type="color"]{width:52px;height:36px;border:none;background:transparent;padding:0;cursor:pointer}
  .actions{display:flex;gap:.5rem;margin-top:.75rem}
  .btn{flex:1;background:var(--accent);color:#001016;font-weight:600;border:none;padding:.6rem .8rem;border-radius:10px;cursor:pointer}
  .btn.secondary{background:#232a36;color:#c8d0e0;border:1px solid #ffffff1f}
  #goShade{position:absolute;inset:0;background:radial-gradient(120% 80% at 50% 40%,rgba(0,0,0,.4),rgba(0,0,0,.85));backdrop-filter:blur(2px);display:none}
  #gameOverImg{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%) scale(.96);display:none;width:min(80vw,820px);filter:drop-shadow(0 12px 30px rgba(0,0,0,.6));opacity:0;transition:transform .35s cubic-bezier(.2,.8,.2,1),opacity .35s ease}
  #gameOverImg.show{display:block;opacity:1;transform:translate(-50%,-50%) scale(1)}
  .splash{position:absolute;inset:0;z-index:50;display:grid;place-items:center;background:radial-gradient(100% 120% at 50% 20%,#0f1a2a,#0b0f16 60%)}
  .splash.out{opacity:0;pointer-events:none;transition:opacity .6s ease}
  .logo{position:relative;width:min(86vw,980px);height:min(42vh,340px);display:grid;place-items:center}
  .title{position:absolute;top:0;left:50%;transform:translateX(-50%);font-size:clamp(34px,6vw,86px);font-weight:900;letter-spacing:.08em;opacity:.95}
  .title span{display:inline-block;transform:translateY(12px);animation:rise .9s forwards ease}
  .title span:nth-child(2){animation-delay:.05s}.title span:nth-child(3){animation-delay:.1s}.title span:nth-child(4){animation-delay:.15s}.title span:nth-child(5){animation-delay:.2s}.title span:nth-child(6){animation-delay:.25s}.title span:nth-child(7){animation-delay:.3s}.title span:nth-child(8){animation-delay:.35s}.title span:nth-child(9){animation-delay:.4s}
  .road{position:absolute;left:6%;right:6%;top:58%;height:14px;background:#2b2f3a;border-radius:999px;box-shadow:0 6px 24px rgba(0,0,0,.35) inset,0 4px 12px rgba(0,0,0,.25)}
  .road:before{content:"";position:absolute;left:0;right:0;top:50%;height:4px;transform:translateY(-50%);background:repeating-linear-gradient(90deg,transparent 0 36px,#c8d0e0 36px 72px);opacity:.8;filter:drop-shadow(0 1px 1px rgba(0,0,0,.4))}
  .cubeIntro{position:absolute;top:50%;left:6%;width:38px;height:38px;background:var(--player);border-radius:6px;box-shadow:0 0 0 2px #0006,0 10px 18px #0007;transform:translate(-50%,-50%);animation:drive 1.7s cubic-bezier(.2,.9,.2,1) .35s forwards}
  .trailIntro{position:absolute;top:50%;left:6%;height:10px;transform:translateY(-50%);background:linear-gradient(90deg,var(--player),transparent 70%);filter:blur(6px);border-radius:10px;opacity:.45;animation:trail 1.7s cubic-bezier(.2,.9,.2,1) .35s forwards}
  .footerName{position:absolute;bottom:10px;left:50%;transform:translateX(-50%);font-size:1.2rem;color:#fff;opacity:0.8}
  @keyframes rise{to{transform:translateY(0)}}
  @keyframes drive{to{left:94%}}
  @keyframes trail{from{left:6%;width:0}to{left:6%;width:88%}}
</style>
</head>
<body>
<div id="wrap">
  <header>
    <b>Road Cube</b> — Z/Q/S/D ou W/A/S/D + flèches · R = nouvelle carte · Échap = pause
  </header>
  <div id="game">
    <div class="splash" id="splash">
      <div class="logo">
        <div class="title" aria-label="ROAD CUBE">
          <span>R</span><span>O</span><span>A</span><span>D</span>
          <span style="width:.5ch;display:inline-block"></span>
          <span>C</span><span>U</span><span>B</span><span>E</span>
        </div>
        <div class="road"></div>
        <div class="trailIntro"></div>
        <div class="cubeIntro"></div>
        <div class="footerName">Luca</div>
      </div>
    </div>
    <canvas id="gameCanvas" width="1024" height="640"></canvas>
    <div id="goShade"></div>
    <img id="gameOverImg" alt="Game Over" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAAQCAYAAAB49NfEAAAACXBIWXMAAAsSAAALEgHS3X78AAAAGXRFWHRTb2Z0d2FyZQBwYWludC5uZXQgNC4yLjFZ3zU2AAAAP0lEQVRYhe3QwQnAIBAF0Zm8/6mYF0wqYk8qYgCwqvI9rQhQ3m8vTTv0kGJw3r8Cw8g1y8F6m6lQkZcM0bYp5i2K8c7QyqQ0g6w3gA0f4y+9xH3gJ6m0v0cL0j5AAAAAElFTkSuQmCC" />
    <div class="scoreTop" id="scoreTop"></div>
    <div class="menu" id="menu">
      <div class="panel">
        <h1>Choisis tes couleurs</h1>
        <div class="row"><label for="cubeColor">Couleur du cube</label><input id="cubeColor" type="color" value="#7CFF88"></div>
        <div class="row"><label for="trailColor">Couleur de la traînée</label><input id="trailColor" type="color" value="#7CFF88"></div>
        <div class="actions">
          <button class="btn" id="startBtn">Jouer</button>
          <button class="btn secondary" id="randomBtn">Aléatoire</button>
        </div>
      </div>
    </div>
  </div>
  <div class="hud" id="hud"></div>
</div>
<script>
const TILE=32,MAP_W=90,MAP_H=90,ROOM_ATTEMPTS=80,ENEMIES_START=12,ENEMY_SPEED=0.10,PLAYER_MAX_SPEED=0.22,PLAYER_ACCEL=0.0032,PLAYER_FRICTION=0.0020,POINTS_PER_LOOT=10,PLAYER_START_HEALTH=100,ENEMY_DAMAGE=10,TRAIL_LENGTH=12,TRAIL_SPACING=6;
const canvas=document.getElementById('gameCanvas');
const ctx=canvas.getContext('2d');
const hud=document.getElementById('hud');
const scoreTop=document.getElementById('scoreTop');
const menu=document.getElementById('menu');
const cubeColorInput=document.getElementById('cubeColor');
const trailColorInput=document.getElementById('trailColor');
const startBtn=document.getElementById('startBtn');
const randomBtn=document.getElementById('randomBtn');
const gameOverImg=document.getElementById('gameOverImg');
const goShade=document.getElementById('goShade');
const splash=document.getElementById('splash');
let last=performance.now();
const css=v=>getComputedStyle(document.documentElement).getPropertyValue(v).trim();
const C={wall:css('--wall'),floor:css('--floor'),loot:css('--loot'),enemy:css('--enemy')};
let playerColor=css('--player')||'#7CFF88';
let trailColor=playerColor;
const input={up:false,down:false,left:false,right:false,paused:true,lock:false};
const player={x:0,y:0,vx:0,vy:0,size:20,half:10,score:0,health:PLAYER_START_HEALTH};
let enemies=[],map=[],rooms=[],cam={x:0,y:0},lootCount=0,trail=[];
function emptyMap(){map=Array.from({length:MAP_H},()=>Array(MAP_W).fill(1));}
function carveRect(x,y,w,h,val){for(let j=y;j<y+h;j++){if(j<1||j>=MAP_H-1)continue;for(let i=x;i<x+w;i++){if(i<1||i>=MAP_W-1)continue;map[j][i]=val;}}}
function roomsOverlap(a,b){return !(a.x+a.w+1<b.x||b.x+b.w+1<a.x||a.y+a.h+1<b.y||b.y+b.h+1<a.y);} 
function addRooms(){rooms=[];for(let k=0;k<ROOM_ATTEMPTS;k++){const w=6+((Math.random()*8)|0),h=6+((Math.random()*8)|0),x=1+((Math.random()*(MAP_W-w-2))|0),y=1+((Math.random()*(MAP_H-h-2))|0);const room={x,y,w,h,cx:(x+(w/2))|0,cy:(y+(h/2))|0};if(rooms.every(r=>!roomsOverlap(r,room))){rooms.push(room);carveRect(x,y,w,h,0);} }
if(!rooms.length){const w=12,h=12,x=((MAP_W-w)/2)|0,y=((MAP_H-h)/2)|0;rooms.push({x,y,w,h,cx:(x+(w/2))|0,cy:(y+(h/2))|0});carveRect(x,y,w,h,0);} }
function connectRooms(){rooms.sort((a,b)=>a.cx-b.cx);for(let i=1;i<rooms.length;i++){const a=rooms[i-1],b=rooms[i];const x1=a.cx,y1=a.cy,x2=b.cx,y2=b.cy;for(let x=Math.min(x1,x2);x<=Math.max(x1,x2);x++){if(y1>=0&&y1<MAP_H&&x>=0&&x<MAP_W)map[y1][x]=0;}for(let y=Math.min(y1,y2);y<=Math.max(y1,y2);y++){if(y>=0&&y<MAP_H&&x2>=0&&x2<MAP_W)map[y][x2]=0;}}}
function placeChests(){let placed=0,target=10+((Math.random()*10)|0);while(placed<target){const x=(Math.random()*MAP_W)|0,y=(Math.random()*MAP_H)|0;if(map[y]?.[x]===0){map[y][x]=2;placed++;}}}
function findAnyFloor(){for(let y=1;y<MAP_H-1;y++){for(let x=1;x<MAP_W-1;x++){if(map[y][x]===0)return {x,y};}}return {x:(MAP_W/2)|0,y:(MAP_H/2)|0};}
function generateLevel(){emptyMap();addRooms();connectRooms();placeChests();const startRoom=rooms[0];let cx,cy;if(startRoom){cx=startRoom.cx;cy=startRoom.cy;if(map[cy]?.[cx]!==0){const f=findAnyFloor();cx=f.x;cy=f.y;}}else{const f=findAnyFloor();cx=f.x;cy=f.y;}player.x=cx*TILE+TILE/2;player.y=cy*TILE+TILE/2;player.vx=0;player.vy=0;player.score=0;player.health=PLAYER_START_HEALTH;enemies=[];for(let i=0;i<ENEMIES_START;i++)spawnEnemyFarFromPlayer();lootCount=0;trail=[];updateScoreTop();}
function spawnEnemyFarFromPlayer(){for(let tries=0;tries<200;tries++){const x=(Math.random()*MAP_W)|0,y=(Math.random()*MAP_H)|0;if(map[y]?.[x]===0){const wx=x*TILE+TILE/2,wy=y*TILE+TILE/2,dx=wx-player.x,dy=wy-player.y;if(Math.hypot(dx,dy)>10*TILE){enemies.push({x:wx,y:wy,size:20,half:10,color:C.enemy,speed:ENEMY_SPEED});return;}}}}
function tileAt(px,py){const tx=Math.floor(px/TILE),ty=Math.floor(py/TILE);if(ty<0||ty>=MAP_H||tx<0||tx>=MAP_W)return 1;return map[ty][tx];}
function aabbCollidesWithWalls(x,y,half){return tileAt(x-half,y-half)===1||tileAt(x+half,y-half)===1||tileAt(x-half,y+half)===1||tileAt(x+half,y+half)===1;}
function tryMove(ent,dx,dy){let nx=ent.x+dx;if(!aabbCollidesWithWalls(nx,ent.y,ent.half))ent.x=nx;let ny=ent.y+dy;if(!aabbCollidesWithWalls(ent.x,ny,ent.half))ent.y=ny;}
function clamp(v,min,max){return Math.min(max,Math.max(min,v));}
function updateScoreTop(){scoreTop.textContent=`Score: ${player.score} | Vie: ${player.health}`;}
function pushTrail(){const lastNode=trail[trail.length-1];const dx=player.x-(lastNode?lastNode.x:player.x),dy=player.y-(lastNode?lastNode.y:player.y);if(!lastNode||Math.hypot(dx,dy)>=TRAIL_SPACING){trail.push({x:player.x,y:player.y});if(trail.length>TRAIL_LENGTH)trail.shift();}}
function damagePlayer(amount){if(input.lock)return;player.health=Math.max(0,player.health-amount);updateScoreTop();if(player.health<=0){input.lock=true;goShade.style.display='block';gameOverImg.classList.add('show');setTimeout(()=>{gameOverImg.classList.remove('show');goShade.style.display='none';input.lock=false;generateLevel();},2000);}}
function update(dt){if(input.paused||input.lock)return;let ax=(input.right?1:0)-(input.left?1:0),ay=(input.down?1:0)-(input.up?1:0);if(ax||ay){const l=Math.hypot(ax,ay);ax/=l;ay/=l;player.vx+=ax*PLAYER_ACCEL*dt;player.vy+=ay*PLAYER_ACCEL*dt;}const sp=Math.hypot(player.vx,player.vy);if(sp>0){const dec=PLAYER_FRICTION*dt,ns=Math.max(0,sp-dec),k=ns/sp;player.vx*=k;player.vy*=k;}const s2=Math.hypot(player.vx,player.vy);if(s2>PLAYER_MAX_SPEED){const k=PLAYER_MAX_SPEED/s2;player.vx*=k;player.vy*=k;}tryMove(player,player.vx*dt,player.vy*dt);pushTrail();const tx=Math.floor(player.x/TILE),ty=Math.floor(player.y/TILE);if(map[ty]?.[tx]===2){map[ty][tx]=0;lootCount++;player.score+=POINTS_PER_LOOT;updateScoreTop();spawnEnemyFarFromPlayer();}for(const e of enemies){const dx=player.x-e.x,dy=player.y-e.y,d=Math.hypot(dx,dy)||1;if(d<player.half+e.half){damagePlayer(ENEMY_DAMAGE);}const sx=(dx/d)*e.speed*dt,sy=(dy/d)*e.speed*dt;tryMove(e,sx,sy);}const worldW=MAP_W*TILE,worldH=MAP_H*TILE,targetX=clamp(player.x-canvas.width/2,0,Math.max(0,worldW-canvas.width)),targetY=clamp(player.y-canvas.height/2,0,Math.max(0,worldH-canvas.height)),k=1-Math.exp(-dt*0.01);cam.x+=(targetX-cam.x)*k;cam.y+=(targetY-cam.y)*k;hud.textContent=`Loot: ${lootCount}  |  Ennemis: ${enemies.length}  |  R pour régénérer`;}
function drawTrail(){if(!trail.length)return;for(let i=0;i<trail.length;i++){const t=trail[i];const p=i/(trail.length-1||1);const size=player.size*(0.6+0.4*(1-p));ctx.globalAlpha=0.25+0.45*p;ctx.fillStyle=trailColor;ctx.fillRect(Math.floor(t.x-size/2-cam.x),Math.floor(t.y-size/2-cam.y),size,size);}ctx.globalAlpha=1;}
function draw(){ctx.clearRect(0,0,canvas.width,canvas.height);const startX=Math.floor(cam.x/TILE)-1,startY=Math.floor(cam.y/TILE)-1,endX=Math.ceil((cam.x+canvas.width)/TILE)+1,endY=Math.ceil((cam.y+canvas.height)/TILE)+1;for(let ty=startY;ty<endY;ty++){for(let tx=startX;tx<endX;tx++){if(ty<0||tx<0||ty>=MAP_H||tx>=MAP_W)continue;const t=map[ty][tx],sx=tx*TILE-cam.x,sy=ty*TILE-cam.y;if(t===1){ctx.fillStyle=C.wall;ctx.fillRect(sx,sy,TILE,TILE);}else{ctx.fillStyle=C.floor;ctx.fillRect(sx,sy,TILE,TILE);if(t===2){ctx.fillStyle=C.loot;ctx.fillRect(sx+8,sy+8,16,16);}}}}for(const e of enemies){ctx.fillStyle=C.enemy;ctx.fillRect(Math.floor(e.x-e.half-cam.x),Math.floor(e.y-e.half-cam.y),e.size,e.size);}drawTrail();ctx.fillStyle=playerColor;ctx.fillRect(Math.floor(player.x-player.half-cam.x),Math.floor(player.y-player.half-cam.y),player.size,player.size);} 
function loop(ts){const dt=Math.min(50,ts-last);last=ts;update(dt);draw();requestAnimationFrame(loop);} 
function init(){generateLevel();requestAnimationFrame(loop);} 
function randHex(){return '#'+Math.floor(Math.random()*0xFFFFFF).toString(16).padStart(6,'0');}
randomBtn.addEventListener('click',()=>{cubeColorInput.value=randHex();trailColorInput.value=randHex();});
startBtn.addEventListener('click',()=>{playerColor=cubeColorInput.value;trailColor=trailColorInput.value;menu.style.display='none';input.paused=false;});
window.addEventListener('keydown',e=>{const c=e.code;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","Space"].includes(c))e.preventDefault();if(c==="KeyW"||c==="ArrowUp"||c==="KeyZ")input.up=true;if(c==="KeyS"||c==="ArrowDown")input.down=true;if(c==="KeyA"||c==="ArrowLeft"||c==="KeyQ")input.left=true;if(c==="KeyD"||c==="ArrowRight")input.right=true;if(c==="KeyR"){generateLevel();}if(c==="Escape"){if(menu.style.display!=='none'){menu.style.display='none';input.paused=false;}else{menu.style.display='grid';input.paused=true;}}});
window.addEventListener('keyup',e=>{const c=e.code;if(c==="KeyW"||c==="ArrowUp"||c==="KeyZ")input.up=false;if(c==="KeyS"||c==="ArrowDown")input.down=false;if(c==="KeyA"||c==="ArrowLeft")input.left=false;if(c==="KeyD"||c==="ArrowRight")input.right=false;});
init();
setTimeout(()=>{splash.classList.add('out')},2300);
splash.addEventListener('click',()=>splash.classList.add('out'));
</script>
</body>
</html>
